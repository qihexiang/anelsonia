<!DOCTYPE html><html class="default"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>Freesia - v0.10.6</title><meta name="description" content="Documentation for Freesia - v0.10.6"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script async src="assets/search.js" id="search-script"></script></head><body><script>document.body.classList.add(localStorage.getItem("tsd-theme") || "os")</script><header><div class="tsd-page-toolbar"><div class="container"><div class="table-wrap"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget search no-caption">Search</label><input type="text" id="tsd-search-field"/></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">Freesia - v0.10.6</a></div><div class="table-cell" id="tsd-widgets"><div id="tsd-filter"><a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a><div class="tsd-filter-group"><div class="tsd-select" id="tsd-filter-visibility"><span class="tsd-select-label">All</span><ul class="tsd-select-list"><li data-value="public">Public</li><li data-value="protected">Public/Protected</li><li data-value="private" class="selected">All</li></ul></div> <input type="checkbox" id="tsd-filter-inherited" checked/><label class="tsd-widget" for="tsd-filter-inherited">Inherited</label><input type="checkbox" id="tsd-filter-externals" checked/><label class="tsd-widget" for="tsd-filter-externals">Externals</label></div></div><a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a></div></div></div></div><div class="tsd-page-title"><div class="container"><h1>Freesia - v0.10.6</h1></div></div></header><div class="container container-main"><div class="row"><div class="col-8 col-content"><div class="tsd-panel tsd-typography">
<a href="#freesia-a-typescript-library-for-building-nodejs-http-servers" id="freesia-a-typescript-library-for-building-nodejs-http-servers" style="color: inherit; text-decoration: none;">
  <h1>Freesia: a TypeScript library for building Node.js HTTP servers.</h1>
</a>
<p>Freesia is a library for building Node.js HTTP servers, it provides a way to describe you HTTP handling process in a functional way.</p>
<p>For example, a hello world application in express is like this:</p>
<pre><code class="language-ts"><span class="hl-8">import</span><span class="hl-1"> </span><span class="hl-5">express</span><span class="hl-1"> </span><span class="hl-8">from</span><span class="hl-1"> </span><span class="hl-4">&quot;express&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">app</span><span class="hl-1"> = </span><span class="hl-3">express</span><span class="hl-1">();</span><br/><span class="hl-5">app</span><span class="hl-1">.</span><span class="hl-3">use</span><span class="hl-1">((</span><span class="hl-5">req</span><span class="hl-1">, </span><span class="hl-5">res</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">res</span><span class="hl-1">.</span><span class="hl-3">send</span><span class="hl-1">(</span><span class="hl-4">&quot;hello, world&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">});</span><br/><span class="hl-5">app</span><span class="hl-1">.</span><span class="hl-3">listen</span><span class="hl-1">(</span><span class="hl-9">8000</span><span class="hl-1">);</span>
</code></pre>
<p>The handler is a function that returns void, it&#39;s strange and un-typed in programming. Using Freesia, you can write like this:</p>
<pre><code class="language-ts"><span class="hl-8">import</span><span class="hl-1"> { </span><span class="hl-5">shimHTTP</span><span class="hl-1">, </span><span class="hl-5">createRes</span><span class="hl-1"> } </span><span class="hl-8">from</span><span class="hl-1"> </span><span class="hl-4">&quot;freesia&quot;</span><span class="hl-1">;</span><br/><span class="hl-8">import</span><span class="hl-1"> { </span><span class="hl-5">createServer</span><span class="hl-1"> } </span><span class="hl-8">from</span><span class="hl-1"> </span><span class="hl-4">&quot;http&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-3">createServer</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-3">shimHTTP</span><span class="hl-1">(</span><span class="hl-0">async</span><span class="hl-1"> (</span><span class="hl-5">req</span><span class="hl-1">: </span><span class="hl-7">HttpReq</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> </span><span class="hl-3">createRes</span><span class="hl-1">(</span><span class="hl-4">&quot;hello, world&quot;</span><span class="hl-1">))</span><br/><span class="hl-1">).</span><span class="hl-3">listen</span><span class="hl-1">(</span><span class="hl-9">8000</span><span class="hl-1">);</span>
</code></pre>
<p>It was clear and fully typed.</p>

<a href="#main-function-and-shimhttp" id="main-function-and-shimhttp" style="color: inherit; text-decoration: none;">
  <h2>main function and shimHTTP</h2>
</a>
<p>When using Freesia, there is nothing like <code>app</code> object in express or koa. You need to write the entry function to handle request by your self. It should receive a parameter in type <code>HttpReq</code> (it&#39;s the union type of http and http2 request type), and return an object of <code>ResponseProps</code> type in synchorous or asynchorous way. After that, you can use <code>shimHTTP</code> to transform it to a handler for <code>createServer</code> in <code>http</code> or <code>createSecureServer</code> in <code>http2</code>.</p>

<a href="#routes" id="routes" style="color: inherit; text-decoration: none;">
  <h2>Routes</h2>
</a>

<a href="#createroute" id="createroute" style="color: inherit; text-decoration: none;">
  <h3>createRoute</h3>
</a>
<p>A route can be described with a path matching pattern and a handler, for example, you may need a route that can say hello to the user, like this:</p>
<blockquote>
<p>Browser: GET /hello/mary<br>Server: hello, mary</p>
</blockquote>
<p>With <code>createRoute</code> function, you can create such a route like this:</p>
<pre><code class="language-ts"><span class="hl-8">export</span><span class="hl-1"> </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">helloRoute</span><span class="hl-1"> = </span><span class="hl-3">createRoute</span><span class="hl-1">(</span><span class="hl-4">&quot;/hello/&lt;username&gt;&quot;</span><span class="hl-1">, ({ </span><span class="hl-5">username</span><span class="hl-1"> }) </span><span class="hl-0">=&gt;</span><br/><span class="hl-1">    </span><span class="hl-3">createRes</span><span class="hl-1">(</span><span class="hl-4">`hello, </span><span class="hl-0">${</span><span class="hl-5">username</span><span class="hl-0">}</span><span class="hl-4">`</span><span class="hl-1">)</span><br/><span class="hl-1">);</span>
</code></pre>
<p>The handler parameters will be inferred automatically by the path patter you give. Route params can be described in such ways:</p>
<ul>
<li><code>&lt;ParamName&gt;</code> non-greedily match at least one characters:<ul>
<li><code>/user/&lt;username&gt;</code> can match <code>/user/hexiang</code> <code>(username</code> is <code>&quot;hexiang&quot;</code>) and <code>/user/hexiang/avatar</code> (<code>username</code> is <code>&quot;hexiang/avatar&quot;</code>)</li>
<li><code>/user/&lt;username&gt;/</code> can match <code>/user/hexiang/</code> (<code>username</code> is <code>&quot;hexiang&quot;</code>) but can&#39;t match <code>/user/hexiang/avatar</code> (un-matched after the third slash).</li>
</ul>
</li>
<li><code>&lt;[ParamName]&gt;</code> greedily match at least one characters:<ul>
<li><code>/user/&lt;username&gt;/&lt;[rest]&gt;/</code> can match <code>/user/hexiang/avatar/</code> (<code>rest</code> is <code>&quot;avatar&quot;</code>) and <code>/user/hexiang/info/gender/</code> (<code>rest</code> is <code>&quot;info/gender&quot;</code>)</li>
</ul>
</li>
<li><code>[ParamName]</code> greedily match at least zero characters:<ul>
<li><code>/files/[filepath]</code> can match <code>/files/README.md</code> and <code>/files/</code> (<code>filepath</code> is <code>&quot;&quot;</code>, and you may like to give a list of files under root directory under this situation).</li>
</ul>
</li>
</ul>
<p><code>createRoute</code> returns a function that receive a string as paramters, and can return what the given handler returns (anything, not only objects created by <code>createRes</code>) if the string matched given pattern. If not matched, the function will return <code>null</code>. You can define many routes in practice:</p>
<pre><code class="language-ts"><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">helloRoute</span><span class="hl-1"> = </span><span class="hl-3">createRoute</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-4">&quot;/hello/&lt;username&gt;&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    ({ </span><span class="hl-5">username</span><span class="hl-1"> }) </span><span class="hl-0">=&gt;</span><span class="hl-1"> </span><span class="hl-4">`hello, </span><span class="hl-0">${</span><span class="hl-5">username</span><span class="hl-0">}</span><span class="hl-4">`</span><br/><span class="hl-1">);</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">goodByeRoute</span><span class="hl-1"> = </span><span class="hl-3">createRoute</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-4">&quot;/goodbye/&lt;username&gt;&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    ({ </span><span class="hl-5">username</span><span class="hl-1"> }) </span><span class="hl-0">=&gt;</span><span class="hl-1"> </span><span class="hl-4">`goodbye, </span><span class="hl-0">${</span><span class="hl-5">username</span><span class="hl-0">}</span><span class="hl-4">`</span><br/><span class="hl-1">);</span><br/><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-3">main</span><span class="hl-1"> = </span><span class="hl-0">async</span><span class="hl-1"> (</span><span class="hl-5">req</span><span class="hl-1">: </span><span class="hl-7">HttpReq</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">message</span><span class="hl-1"> =</span><br/><span class="hl-1">        </span><span class="hl-3">helloRoute</span><span class="hl-1">(</span><span class="hl-5">req</span><span class="hl-1">.</span><span class="hl-5">url</span><span class="hl-1"> ?? </span><span class="hl-4">&quot;/&quot;</span><span class="hl-1">) ??</span><br/><span class="hl-1">        </span><span class="hl-3">goodbyeRoute</span><span class="hl-1">(</span><span class="hl-5">req</span><span class="hl-1">.</span><span class="hl-5">url</span><span class="hl-1"> ?? </span><span class="hl-4">&quot;/&quot;</span><span class="hl-1">) ??</span><br/><span class="hl-1">        </span><span class="hl-10">/**</span><br/><span class="hl-10">         * each route function can return null,</span><br/><span class="hl-10">         * you must handle it.</span><br/><span class="hl-10">         */</span><br/><span class="hl-1">        </span><span class="hl-4">&quot;No route matched&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-8">return</span><span class="hl-1"> </span><span class="hl-3">createRes</span><span class="hl-1">(</span><span class="hl-5">message</span><span class="hl-1">);</span><br/><span class="hl-1">};</span>
</code></pre>

<a href="#createswitcher" id="createswitcher" style="color: inherit; text-decoration: none;">
  <h3>createSwitcher</h3>
</a>
<p>As you see, we need to give <code>req.url</code> to each route function, that&#39;s not good. Freesia provides a function called <code>createSwitcher</code> to solve this problem. It can select the right route by given string:</p>
<pre><code class="language-ts"><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">helloRoute</span><span class="hl-1"> = </span><span class="hl-3">createRoute</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-4">&quot;/hello/&lt;username&gt;&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    ({ </span><span class="hl-5">username</span><span class="hl-1"> }) </span><span class="hl-0">=&gt;</span><span class="hl-1"> </span><span class="hl-4">`hello, </span><span class="hl-0">${</span><span class="hl-5">username</span><span class="hl-0">}</span><span class="hl-4">`</span><br/><span class="hl-1">);</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">goodByeRoute</span><span class="hl-1"> = </span><span class="hl-3">createRoute</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-4">&quot;/goodbye/&lt;username&gt;&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    ({ </span><span class="hl-5">username</span><span class="hl-1"> }) </span><span class="hl-0">=&gt;</span><span class="hl-1"> </span><span class="hl-4">`goodbye, </span><span class="hl-0">${</span><span class="hl-5">username</span><span class="hl-0">}</span><span class="hl-4">`</span><br/><span class="hl-1">);</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">switcher</span><span class="hl-1"> = </span><span class="hl-3">createSwitcher</span><span class="hl-1">(</span><span class="hl-5">helloRoute</span><span class="hl-1">, </span><span class="hl-5">goodByeRoute</span><span class="hl-1">);</span><br/><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-3">main</span><span class="hl-1"> = </span><span class="hl-0">async</span><span class="hl-1"> (</span><span class="hl-5">req</span><span class="hl-1">: </span><span class="hl-7">HttpReq</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">message</span><span class="hl-1"> =</span><br/><span class="hl-1">        </span><span class="hl-3">switcher</span><span class="hl-1">(</span><span class="hl-5">req</span><span class="hl-1">.</span><span class="hl-5">url</span><span class="hl-1"> ?? </span><span class="hl-4">&quot;/&quot;</span><span class="hl-1">) ??</span><br/><span class="hl-1">        </span><span class="hl-10">/**</span><br/><span class="hl-10">         * each route function can return null,</span><br/><span class="hl-10">         * you must handle it.</span><br/><span class="hl-10">         */</span><br/><span class="hl-1">        </span><span class="hl-4">&quot;No route matched&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-8">return</span><span class="hl-1"> </span><span class="hl-3">createRes</span><span class="hl-1">(</span><span class="hl-5">message</span><span class="hl-1">);</span><br/><span class="hl-1">};</span>
</code></pre>
<p><code>createSwitcher</code> returns another route function that connected to all given route functions. All given route functions should have same return type, or you can specify the Union-Type in <code>createSwitcher&lt;T&gt;</code>.</p>

<a href="#createswrt" id="createswrt" style="color: inherit; text-decoration: none;">
  <h3>createSwRt</h3>
</a>
<p>Another way to create switchers is using <code>createSwRt</code>, you can create routes and connect them to switcher at the same time.</p>
<p><code>createSwRt</code> is both a function and a namespace, <code>createSwRt()</code> is equals to <code>createSwRt</code>.</p>
<pre><code class="language-ts"><span class="hl-0">const</span><span class="hl-1"> { </span><span class="hl-2">switcher</span><span class="hl-1"> } = </span><span class="hl-5">createSwRt</span><br/><span class="hl-1">    .</span><span class="hl-3">route</span><span class="hl-1">(</span><span class="hl-4">&quot;/hello/&lt;username&gt;&quot;</span><span class="hl-1">. ({ </span><span class="hl-5">username</span><span class="hl-1"> }) </span><span class="hl-0">=&gt;</span><span class="hl-1"> </span><span class="hl-4">`hello, </span><span class="hl-0">${</span><span class="hl-5">username</span><span class="hl-0">}</span><span class="hl-4">`</span><span class="hl-1">)</span><br/><span class="hl-1">    .</span><span class="hl-3">route</span><span class="hl-1">(</span><span class="hl-4">&quot;/goodbye/&lt;username&gt;&quot;</span><span class="hl-1">, ({ </span><span class="hl-5">username</span><span class="hl-1"> }) </span><span class="hl-0">=&gt;</span><span class="hl-1"> </span><span class="hl-4">`goodbye, </span><span class="hl-0">${</span><span class="hl-5">username</span><span class="hl-0">}</span><span class="hl-4">`</span><span class="hl-1">)</span><br/><span class="hl-1">    </span><span class="hl-10">/**</span><br/><span class="hl-10">     * fallback method will return a route function that will not return null,</span><br/><span class="hl-10">     * if no patter matched, it will execute the fallback handler. If you don&#39;t</span><br/><span class="hl-10">     * use fallback method, the switcher can still return null.</span><br/><span class="hl-10">     */</span><br/><span class="hl-1">    .</span><span class="hl-3">fallback</span><span class="hl-1">(</span><span class="hl-5">url</span><span class="hl-1"> </span><span class="hl-0">=&gt;</span><span class="hl-1"> </span><span class="hl-4">`No pattern matched </span><span class="hl-0">${</span><span class="hl-5">url</span><span class="hl-0">}</span><span class="hl-4">`</span><span class="hl-1">)</span><br/><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-3">main</span><span class="hl-1"> = </span><span class="hl-0">async</span><span class="hl-1"> (</span><span class="hl-5">req</span><span class="hl-1">: </span><span class="hl-7">HttpReq</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">message</span><span class="hl-1"> = </span><span class="hl-3">switcher</span><span class="hl-1">(</span><span class="hl-5">req</span><span class="hl-1">.</span><span class="hl-5">url</span><span class="hl-1"> ?? </span><span class="hl-4">&quot;/&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-8">return</span><span class="hl-1"> </span><span class="hl-3">createRes</span><span class="hl-1">(</span><span class="hl-5">message</span><span class="hl-1">)</span><br/><span class="hl-1">}</span>
</code></pre>
<p>The return type is inferred by the first called <code>route</code> method, if you&#39;d like to specify a union-type as generic type, use <code>route&lt;T&gt;</code>.</p>

<a href="#x-series-route-creators" id="x-series-route-creators" style="color: inherit; text-decoration: none;">
  <h3>X series route creators</h3>
</a>
<p>Some times, route handlers might need arguments which can only accessed in request handling functions. If we define route or switchers outside handler functions, it&#39;s not easy to get these values.</p>
<p>For example, if you&#39;d like to get IP address in handler of <code>helloRoute</code>, you must define it like this:</p>
<pre><code class="language-ts"><span class="hl-8">import</span><span class="hl-1"> </span><span class="hl-5">goodByeRoute</span><span class="hl-1"> </span><span class="hl-8">from</span><span class="hl-1"> </span><span class="hl-4">&quot;./route/goodBye&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-3">main</span><span class="hl-1"> = </span><span class="hl-0">async</span><span class="hl-1"> (</span><span class="hl-5">req</span><span class="hl-1">: </span><span class="hl-7">HttpReq</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">helloRoute</span><span class="hl-1"> = </span><span class="hl-3">createRoute</span><span class="hl-1">(</span><br/><span class="hl-1">        </span><span class="hl-4">&quot;/hello/&lt;username&gt;&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">        ({ </span><span class="hl-5">username</span><span class="hl-1"> }) </span><span class="hl-0">=&gt;</span><br/><span class="hl-1">            </span><span class="hl-4">`hello, </span><span class="hl-0">${</span><span class="hl-5">username</span><span class="hl-0">}</span><span class="hl-4"> from </span><span class="hl-0">${</span><span class="hl-5">req</span><span class="hl-6">.</span><span class="hl-5">socket</span><span class="hl-6">.</span><span class="hl-3">address</span><span class="hl-6">().</span><span class="hl-5">address</span><span class="hl-0">}</span><span class="hl-4">`</span><br/><span class="hl-1">    );</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">switcher</span><span class="hl-1"> = </span><span class="hl-3">createSwitcher</span><span class="hl-1">(</span><span class="hl-5">helloRoute</span><span class="hl-1">, </span><span class="hl-5">goodByeRoute</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-8">return</span><span class="hl-1"> </span><span class="hl-3">createRes</span><span class="hl-1">(</span><span class="hl-3">switcher</span><span class="hl-1">(</span><span class="hl-5">req</span><span class="hl-1">.</span><span class="hl-5">url</span><span class="hl-1"> ?? </span><span class="hl-4">&quot;/&quot;</span><span class="hl-1">) ?? </span><span class="hl-4">&quot;No route matched&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">};</span>
</code></pre>
<p>It&#39;s of course not a good way. But you can use <code>createRouteX</code> to receive an extra param in handlers:</p>
<pre><code class="language-ts"><span class="hl-10">/**</span><br/><span class="hl-10"> * here, helloRoute can receive an extra parameter of HttpReq type.</span><br/><span class="hl-10"> */</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">helloRoute</span><span class="hl-1"> = </span><span class="hl-3">createRouteX</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-4">&quot;/hello/&lt;username&gt;&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    ({ </span><span class="hl-5">username</span><span class="hl-1"> }, </span><span class="hl-5">req</span><span class="hl-1">: </span><span class="hl-7">HttpReq</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><br/><span class="hl-1">        </span><span class="hl-4">`hello, </span><span class="hl-0">${</span><span class="hl-5">username</span><span class="hl-0">}</span><span class="hl-4"> from </span><span class="hl-0">${</span><span class="hl-5">req</span><span class="hl-6">.</span><span class="hl-5">socket</span><span class="hl-6">.</span><span class="hl-3">address</span><span class="hl-6">().</span><span class="hl-5">address</span><span class="hl-0">}</span><span class="hl-4">`</span><br/><span class="hl-1">);</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">goodByeRoute</span><span class="hl-1"> = </span><span class="hl-3">createRouteX</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-4">&quot;/goodbye/&lt;username&gt;&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-10">/**</span><br/><span class="hl-10">     * It&#39;s no problem ignore the extra parameter, it just</span><br/><span class="hl-10">     * declare the same type with helloRoute.</span><br/><span class="hl-10">     */</span><br/><span class="hl-1">    ({ </span><span class="hl-5">username</span><span class="hl-1"> }, </span><span class="hl-5">req</span><span class="hl-1">: </span><span class="hl-7">HttpReq</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> </span><span class="hl-4">`goodbye, </span><span class="hl-0">${</span><span class="hl-5">username</span><span class="hl-0">}</span><span class="hl-4">`</span><br/><span class="hl-1">);</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">switcher</span><span class="hl-1"> = </span><span class="hl-3">createSwitcherX</span><span class="hl-1">(</span><span class="hl-5">helloRoute</span><span class="hl-1">, </span><span class="hl-5">goodByeRoute</span><span class="hl-1">);</span><br/><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-3">main</span><span class="hl-1"> = </span><span class="hl-0">async</span><span class="hl-1"> (</span><span class="hl-5">req</span><span class="hl-1">: </span><span class="hl-7">HttpReq</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-10">/**</span><br/><span class="hl-10">     * Here, switcher can receive the extra parameter</span><br/><span class="hl-10">     */</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">message</span><span class="hl-1"> = </span><span class="hl-3">switcher</span><span class="hl-1">(</span><span class="hl-5">req</span><span class="hl-1">.</span><span class="hl-5">url</span><span class="hl-1"> ?? </span><span class="hl-4">&quot;/&quot;</span><span class="hl-1">, </span><span class="hl-5">req</span><span class="hl-1">) ?? </span><span class="hl-4">&quot;No route matched&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-8">return</span><span class="hl-1"> </span><span class="hl-3">createRes</span><span class="hl-1">(</span><span class="hl-5">message</span><span class="hl-1">);</span><br/><span class="hl-1">};</span>
</code></pre>
<p>There is also <code>createSwRtX</code>:</p>
<pre><code class="language-ts"><span class="hl-0">const</span><span class="hl-1"> { </span><span class="hl-2">switcher</span><span class="hl-1"> } = </span><span class="hl-5">createSwRtX</span><br/><span class="hl-1">    .</span><span class="hl-3">route</span><span class="hl-1">(</span><span class="hl-4">&quot;/hello/&lt;username&gt;&quot;</span><span class="hl-1">. ({ </span><span class="hl-5">username</span><span class="hl-1"> }, </span><span class="hl-5">req</span><span class="hl-1">: </span><span class="hl-7">HttpReq</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> </span><span class="hl-4">`hello, </span><span class="hl-0">${</span><span class="hl-5">username</span><span class="hl-0">}</span><span class="hl-4"> from </span><span class="hl-0">${</span><span class="hl-5">req</span><span class="hl-6">.</span><span class="hl-5">socket</span><span class="hl-6">.</span><span class="hl-3">address</span><span class="hl-6">().</span><span class="hl-5">address</span><span class="hl-0">}</span><span class="hl-4">`</span><span class="hl-1">)</span><br/><span class="hl-1">    </span><span class="hl-10">// No problem ignore extra parameter</span><br/><span class="hl-1">    .</span><span class="hl-3">route</span><span class="hl-1">(</span><span class="hl-4">&quot;/goodbye/&lt;username&gt;&quot;</span><span class="hl-1">, ({ </span><span class="hl-5">username</span><span class="hl-1"> }) </span><span class="hl-0">=&gt;</span><span class="hl-1"> </span><span class="hl-4">`goodbye, </span><span class="hl-0">${</span><span class="hl-5">username</span><span class="hl-0">}</span><span class="hl-4">`</span><span class="hl-1">)</span><br/><span class="hl-1">    </span><span class="hl-10">// fallback handler will also  receive the extra parameter</span><br/><span class="hl-1">    .</span><span class="hl-3">fallback</span><span class="hl-1">((</span><span class="hl-5">url</span><span class="hl-1">, </span><span class="hl-5">req</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> </span><span class="hl-4">`No pattern matched </span><span class="hl-0">${</span><span class="hl-5">url</span><span class="hl-0">}</span><span class="hl-4">, your ip is </span><span class="hl-0">${</span><span class="hl-5">req</span><span class="hl-6">.</span><span class="hl-5">socket</span><span class="hl-6">.</span><span class="hl-3">address</span><span class="hl-6">().</span><span class="hl-5">address</span><span class="hl-0">}</span><span class="hl-4">`</span><span class="hl-1">);</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-3">main</span><span class="hl-1"> = </span><span class="hl-0">async</span><span class="hl-1"> (</span><span class="hl-5">req</span><span class="hl-1">: </span><span class="hl-7">HttpReq</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">message</span><span class="hl-1"> = </span><span class="hl-3">switcher</span><span class="hl-1">(</span><span class="hl-5">req</span><span class="hl-1">.</span><span class="hl-5">url</span><span class="hl-1"> ?? </span><span class="hl-4">&quot;/&quot;</span><span class="hl-1">, </span><span class="hl-5">req</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-8">return</span><span class="hl-1"> </span><span class="hl-3">createRes</span><span class="hl-1">(</span><span class="hl-5">message</span><span class="hl-1">)</span><br/><span class="hl-1">}</span>
</code></pre>

<a href="#magical-functions" id="magical-functions" style="color: inherit; text-decoration: none;">
  <h2>Magical functions</h2>
</a>
<p>There are some magical functions, which can provide values in a non-pure-functional way.</p>

<a href="#userequest" id="userequest" style="color: inherit; text-decoration: none;">
  <h3>useRequest</h3>
</a>
<p><code>useRequest</code> is the core magical function, all magical function depends on it. In situations what <code>useRequest</code> doesn&#39;t work, all other magical function will not work either.</p>
<p><code>useRequest</code> can be called only in the function called by main function that use as parameter of <code>shimHTTP</code>. <code>useRequest</code> provides a way to get <code>req</code> object, while you don&#39;t pass it as parameters.</p>
<p>Such code is ok:</p>
<pre><code class="language-ts"><span class="hl-3">createServer</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-3">shimHTTP</span><span class="hl-1">(</span><span class="hl-0">async</span><span class="hl-1"> (</span><span class="hl-5">req</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-8">return</span><span class="hl-1"> </span><span class="hl-3">layer1</span><span class="hl-1">();</span><br/><span class="hl-1">    })</span><br/><span class="hl-1">).</span><span class="hl-3">listen</span><span class="hl-1">(</span><span class="hl-9">8000</span><span class="hl-1">);</span><br/><br/><span class="hl-0">function</span><span class="hl-1"> </span><span class="hl-3">layer1</span><span class="hl-1">() {</span><br/><span class="hl-1">    </span><span class="hl-8">return</span><span class="hl-1"> </span><span class="hl-3">layer2</span><span class="hl-1">();</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-0">function</span><span class="hl-1"> </span><span class="hl-3">layer2</span><span class="hl-1">() {</span><br/><span class="hl-1">    </span><span class="hl-8">return</span><span class="hl-1"> </span><span class="hl-3">layer3</span><span class="hl-1">();</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-10">/**</span><br/><span class="hl-10"> * layer3 is called by main function, though indirectly,</span><br/><span class="hl-10"> * it can access `req` by `useRequest`</span><br/><span class="hl-10"> */</span><br/><span class="hl-0">function</span><span class="hl-1"> </span><span class="hl-3">layer3</span><span class="hl-1">() {</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">req</span><span class="hl-1"> = </span><span class="hl-3">useRequest</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-8">return</span><span class="hl-1"> </span><span class="hl-3">createRes</span><span class="hl-1">(</span><span class="hl-5">req</span><span class="hl-1">.</span><span class="hl-5">socket</span><span class="hl-1">.</span><span class="hl-3">address</span><span class="hl-1">().</span><span class="hl-5">address</span><span class="hl-1">);</span><br/><span class="hl-1">}</span>
</code></pre>
<p>But is not ok in this:</p>
<pre><code class="language-ts"><span class="hl-5">databse</span><br/><span class="hl-1">    .</span><span class="hl-3">connect</span><span class="hl-1">()</span><br/><span class="hl-1">    .</span><span class="hl-3">then</span><span class="hl-1">((</span><span class="hl-5">db</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-10">/**</span><br/><span class="hl-10">         * function here is not related to any request,</span><br/><span class="hl-10">         * `useRequest` will throw an error.</span><br/><span class="hl-10">         */</span><br/><span class="hl-1">        </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">req</span><span class="hl-1"> = </span><span class="hl-3">useRequest</span><span class="hl-1">();</span><br/><span class="hl-1">        </span><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-3">log</span><span class="hl-1">(</span><span class="hl-7">JSON</span><span class="hl-1">.</span><span class="hl-3">stringify</span><span class="hl-1">(</span><span class="hl-5">req</span><span class="hl-1">.</span><span class="hl-5">socket</span><span class="hl-1">.</span><span class="hl-3">address</span><span class="hl-1">()));</span><br/><span class="hl-1">        </span><span class="hl-3">createServer</span><span class="hl-1">(</span><br/><span class="hl-1">            </span><span class="hl-3">shimHTTP</span><span class="hl-1">(</span><span class="hl-0">async</span><span class="hl-1"> () </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">                </span><span class="hl-8">return</span><span class="hl-1"> </span><span class="hl-3">createRes</span><span class="hl-1">(</span><span class="hl-9">404</span><span class="hl-1">, </span><span class="hl-4">&quot;Not found&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">            })</span><br/><span class="hl-1">        ).</span><span class="hl-3">listen</span><span class="hl-1">(</span><span class="hl-9">8000</span><span class="hl-1">);</span><br/><span class="hl-1">    })</span><br/><span class="hl-1">    .</span><span class="hl-3">catch</span><span class="hl-1">(</span><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-5">error</span><span class="hl-1">);</span>
</code></pre>

<a href="#useurl" id="useurl" style="color: inherit; text-decoration: none;">
  <h3>useURL</h3>
</a>
<p><code>useURL</code> provides a way to access request url info. Visit API documents <a href="https://qihexiang.github.io/freesia/modules.html#useURL">here</a>.</p>

<a href="#in-direct-magical-functions" id="in-direct-magical-functions" style="color: inherit; text-decoration: none;">
  <h2>In-direct magical functions</h2>
</a>
<p>In-directy magical functions are functions that can be called outside of request handling process, and they return one or more functions that must be called in the process.</p>

<a href="#createflare" id="createflare" style="color: inherit; text-decoration: none;">
  <h3>createFlare</h3>
</a>
<p>createFlare provides a way to declare and access a value for an request handling process.</p>
<pre><code class="language-ts"><span class="hl-8">export</span><span class="hl-1"> </span><span class="hl-0">const</span><span class="hl-1"> [</span><span class="hl-2">assign</span><span class="hl-1">, </span><span class="hl-2">observe</span><span class="hl-1">, </span><span class="hl-2">drop</span><span class="hl-1">] = </span><span class="hl-3">createFlare</span><span class="hl-1">&lt;</span><span class="hl-7">Buffer</span><span class="hl-1">&gt;({</span><br/><span class="hl-1">    </span><span class="hl-5">reassign:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">mutable:</span><span class="hl-1"> </span><span class="hl-0">false</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-3">main</span><span class="hl-1"> = </span><span class="hl-0">async</span><span class="hl-1"> (</span><span class="hl-5">req</span><span class="hl-1">: </span><span class="hl-7">HttpReq</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">body</span><span class="hl-1"> = </span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-3">getRawBody</span><span class="hl-1">(</span><span class="hl-5">req</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-3">assign</span><span class="hl-1">(</span><span class="hl-5">body</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-10">/**</span><br/><span class="hl-10">     * fn1, fn2, fn3 and functions called by them can access body</span><br/><span class="hl-10">     * by observe function.</span><br/><span class="hl-10">     */</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">a</span><span class="hl-1"> = </span><span class="hl-3">fn1</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">b</span><span class="hl-1"> = </span><span class="hl-3">fn2</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">c</span><span class="hl-1"> = </span><span class="hl-3">fn3</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-3">drop</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-8">return</span><span class="hl-1"> </span><span class="hl-3">createRes</span><span class="hl-1">(</span><span class="hl-9">200</span><span class="hl-1">, </span><span class="hl-4">&quot;success&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">};</span>
</code></pre>
<p><code>createFlare</code> can receive a object parameter which as two properties:</p>
<ul>
<li><code>reassign</code> means you can call <code>assign</code> many times to reset the value before call <code>drop</code> to relase it, set it to <code>true</code> when you need to change a primitive value during the process;</li>
<li><code>mutable</code> means the value get from <code>observe</code> should <strong>not</strong> be readonly. It in fact do nothing, and just change the return type of <code>observe</code> in TypeScript. For example, if you assign a ORM object to flare, you should set <code>mutable</code> to <code>true</code>.</li>
</ul>
<p>The three functions return by <code>createFlare</code> is:</p>
<ul>
<li><code>assign</code> assign a value to the flare for current request.</li>
<li><code>observe</code> get the value assigned to the flare.</li>
<li><code>drop</code> deattach the value from the flare, value will not unaccessable after called drop.</li>
</ul>
<blockquote>
<p>This is implemented by <code>WeakMap</code>, so it&#39;s not necessary to call <code>drop</code>.</p>
</blockquote>

<a href="#allowmethods-and-allowmethodsx" id="allowmethods-and-allowmethodsx" style="color: inherit; text-decoration: none;">
  <h3>allowMethods and allowMethodsX</h3>
</a>
<p>These two functions can limits the request methods of handlers binding to routes. For example:</p>
<pre><code class="language-ts"><span class="hl-0">const</span><span class="hl-1"> { </span><span class="hl-2">switcher</span><span class="hl-1"> } = </span><span class="hl-5">createSwRt</span><br/><span class="hl-1">    .</span><span class="hl-3">route</span><span class="hl-1">(</span><br/><span class="hl-1">        </span><span class="hl-4">&quot;/hello/&lt;username&gt;&quot;</span><span class="hl-1">.</span><span class="hl-3">allowMethods</span><span class="hl-1">(</span><br/><span class="hl-1">            ({ </span><span class="hl-5">username</span><span class="hl-1"> }) </span><span class="hl-0">=&gt;</span><span class="hl-1"> </span><span class="hl-4">`hello, </span><span class="hl-0">${</span><span class="hl-5">username</span><span class="hl-0">}</span><span class="hl-4">`</span><span class="hl-1">,</span><br/><span class="hl-1">            [</span><span class="hl-4">&quot;GET&quot;</span><span class="hl-1">]</span><br/><span class="hl-1">        )</span><br/><span class="hl-1">    )</span><br/><span class="hl-1">    .</span><span class="hl-3">route</span><span class="hl-1">(</span><br/><span class="hl-1">        </span><span class="hl-4">&quot;/goodbye/&lt;username&gt;&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-3">allowMethods</span><span class="hl-1">(({ </span><span class="hl-5">username</span><span class="hl-1"> }) </span><span class="hl-0">=&gt;</span><span class="hl-1"> </span><span class="hl-4">`goodbye, </span><span class="hl-0">${</span><span class="hl-5">username</span><span class="hl-0">}</span><span class="hl-4">`</span><span class="hl-1">, [</span><span class="hl-4">&quot;GET&quot;</span><span class="hl-1">])</span><br/><span class="hl-1">    )</span><br/><span class="hl-1">    </span><span class="hl-10">/**</span><br/><span class="hl-10">     * fallback method will return a route function that will not return null,</span><br/><span class="hl-10">     * if no patter matched, it will execute the fallback handler. If you don&#39;t</span><br/><span class="hl-10">     * use fallback method, the switcher can still return null.</span><br/><span class="hl-10">     */</span><br/><span class="hl-1">    .</span><span class="hl-3">fallback</span><span class="hl-1">((</span><span class="hl-5">url</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> </span><span class="hl-4">`No pattern matched </span><span class="hl-0">${</span><span class="hl-5">url</span><span class="hl-0">}</span><span class="hl-4">`</span><span class="hl-1">);</span><br/><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-3">main</span><span class="hl-1"> = </span><span class="hl-0">async</span><span class="hl-1"> (</span><span class="hl-5">req</span><span class="hl-1">: </span><span class="hl-7">HttpReq</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">message</span><span class="hl-1"> = </span><span class="hl-3">switcher</span><span class="hl-1">(</span><span class="hl-5">req</span><span class="hl-1">.</span><span class="hl-5">url</span><span class="hl-1"> ?? </span><span class="hl-4">&quot;/&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-8">return</span><span class="hl-1"> </span><span class="hl-3">createRes</span><span class="hl-1">(</span><span class="hl-5">message</span><span class="hl-1">);</span><br/><span class="hl-1">};</span>
</code></pre>
<p>You can use <code>allowMethodsX</code> for X series functions.</p>
<p>Here are some shortcuts, like: <code>Get</code>, <code>GetX</code>, <code>Post</code>, <code>PostX</code>, etc. <code>All</code> and <code>AllX</code> cover request methods described <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Methods">here</a>.</p>

<a href="#utils" id="utils" style="color: inherit; text-decoration: none;">
  <h2>Utils</h2>
</a>

<a href="#composefn" id="composefn" style="color: inherit; text-decoration: none;">
  <h3>ComposeFn</h3>
</a>
<p><code>ComposeFn</code> provides a way to connect functions together.</p>
<pre><code class="language-ts"><span class="hl-0">const</span><span class="hl-1"> { </span><span class="hl-2">fn</span><span class="hl-1"> } = </span><span class="hl-3">composeFn</span><span class="hl-1">((</span><span class="hl-5">x</span><span class="hl-1">: </span><span class="hl-7">number</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> </span><span class="hl-5">x</span><span class="hl-1"> + </span><span class="hl-9">1</span><span class="hl-1">)</span><br/><span class="hl-1">    .</span><span class="hl-3">next</span><span class="hl-1">((</span><span class="hl-5">x</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> </span><span class="hl-7">Math</span><span class="hl-1">.</span><span class="hl-3">pow</span><span class="hl-1">(</span><span class="hl-5">x</span><span class="hl-1">, </span><span class="hl-9">2</span><span class="hl-1">))</span><br/><span class="hl-1">    .</span><span class="hl-3">next</span><span class="hl-1">((</span><span class="hl-5">x</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> </span><span class="hl-5">x</span><span class="hl-1"> * </span><span class="hl-9">4</span><span class="hl-1">)</span><br/><span class="hl-1">    .</span><span class="hl-3">next</span><span class="hl-1">((</span><span class="hl-5">x</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> </span><span class="hl-4">`final result is </span><span class="hl-0">${</span><span class="hl-5">x</span><span class="hl-0">}</span><span class="hl-4">`</span><span class="hl-1">);</span><br/><br/><span class="hl-3">fn</span><span class="hl-1">(</span><span class="hl-9">1</span><span class="hl-1">); </span><span class="hl-10">// -&gt; &quot;final result is 16&quot;</span>
</code></pre>

<a href="#computation-and-lazy" id="computation-and-lazy" style="color: inherit; text-decoration: none;">
  <h3>Computation and Lazy</h3>
</a>

<a href="#computation" id="computation" style="color: inherit; text-decoration: none;">
  <h4>Computation</h4>
</a>
<p><code>compute</code> can <code>Computation&lt;T&gt;</code> object.</p>
<pre><code class="language-ts"><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">credentialInfo</span><span class="hl-1"> = </span><span class="hl-3">compute</span><span class="hl-1">(</span><span class="hl-5">tokenBuf</span><span class="hl-1"> </span><span class="hl-10">/** Buffer */</span><span class="hl-1">)</span><br/><span class="hl-1">    .</span><span class="hl-3">map</span><span class="hl-1">((</span><span class="hl-5">buf</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> </span><span class="hl-5">buf</span><span class="hl-1">.</span><span class="hl-3">toString</span><span class="hl-1">(</span><span class="hl-4">&quot;utf-8&quot;</span><span class="hl-1">))</span><br/><span class="hl-1">    .</span><span class="hl-3">map</span><span class="hl-1">(</span><span class="hl-5">parseToken</span><span class="hl-1">) </span><span class="hl-10">// parseToken 是一个异步函数</span><br/><span class="hl-1">    .</span><span class="hl-3">aMapSkipNull</span><span class="hl-1">((</span><span class="hl-5">token</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> (</span><span class="hl-3">outDated</span><span class="hl-1">(</span><span class="hl-5">token</span><span class="hl-1">) ? </span><span class="hl-0">null</span><span class="hl-1"> : </span><span class="hl-5">token</span><span class="hl-1">))</span><br/><span class="hl-1">    .</span><span class="hl-3">aMapSkipNull</span><span class="hl-1">((</span><span class="hl-5">token</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> </span><span class="hl-5">token</span><span class="hl-1">.</span><span class="hl-5">username</span><span class="hl-1">).</span><span class="hl-5">value</span><span class="hl-1">; </span><span class="hl-10">// -&gt; Promise&lt;string | null&gt;</span>
</code></pre>
<p>It has 4 methods：</p>
<ul>
<li>map：use a function to deal with internal value</li>
<li>mapSkipNull：use a function to deal with internal value,
but left origin value if it&#39;s undefined and null</li>
<li>aMap：use a function to deal with internal value,
but unpack a Promise the value before call it, and wrap
return into Promise after call it.</li>
<li>aMapSkipNull：use a function to deal with internal value，
if origin value is <code>undefined | null | Promise&lt;undefined | null&gt;</code>,
keep it.</li>
</ul>
<p>Each methods will return a new <code>Computation&lt;T&gt;</code>, if you pass it two different chains, they will not influence each other.</p>

<a href="#lazy" id="lazy" style="color: inherit; text-decoration: none;">
  <h4>Lazy</h4>
</a>
<p>Using <code>computeLazy</code> to create <code>Lazy&lt;T&gt;</code> object，it provides methods as the same as <code>Computation</code>.</p>
<p>The difference between <code>Computation</code> and <code>Lazy</code> is that <code>Computation</code> will compute the value every time called method in chain, but <code>Lazy</code> just compose functions。when you finally access <code>value</code> in <code>Lazy</code> object，the composed functions will be executed. Be careful especailly when functions has side-effection! Every time you access <code>value</code>, composed function will be called.</p>
<p>Just like <code>Computation</code>, methods of <code>Lazy</code> object will return a new <code>Lazy</code> object, but if you pass a <code>Lazy</code> to different chains, the results will not influence each other only if all functions are pure.</p>
</div></div><div class="col-4 col-menu menu-sticky-wrap menu-highlight"><nav class="tsd-navigation primary"><ul><li class="current"><a href="modules.html">Exports</a></li><li class=" tsd-kind-namespace"><a href="modules/createSwRt.html">create<wbr/>Sw<wbr/>Rt</a></li><li class=" tsd-kind-namespace"><a href="modules/createSwRtX.html">create<wbr/>Sw<wbr/>RtX</a></li></ul></nav><nav class="tsd-navigation secondary menu-sticky"><ul><li class="tsd-kind-interface"><a href="interfaces/ResponseProps.html" class="tsd-kind-icon">Response<wbr/>Props</a></li><li class="tsd-kind-type-alias"><a href="modules.html#ResponseBody" class="tsd-kind-icon">Response<wbr/>Body</a></li><li class="tsd-kind-type-alias"><a href="modules.html#AsyncResponse" class="tsd-kind-icon">Async<wbr/>Response</a></li><li class="tsd-kind-class"><a href="classes/Respond.html" class="tsd-kind-icon">Respond</a></li><li class="tsd-kind-function"><a href="modules.html#createRes" class="tsd-kind-icon">create<wbr/>Res</a></li><li class="tsd-kind-type-alias"><a href="modules.html#HeaderValue" class="tsd-kind-icon">Header<wbr/>Value</a></li><li class="tsd-kind-type-alias"><a href="modules.html#HeaderObject" class="tsd-kind-icon">Header<wbr/>Object</a></li><li class="tsd-kind-type-alias"><a href="modules.html#HeaderArray" class="tsd-kind-icon">Header<wbr/>Array</a></li><li class="tsd-kind-type-alias"><a href="modules.html#HeaderCollection" class="tsd-kind-icon">Header<wbr/>Collection</a></li><li class="tsd-kind-enum"><a href="enums/Status.html" class="tsd-kind-icon">Status</a></li><li class="tsd-kind-type-alias"><a href="modules.html#HttpReq" class="tsd-kind-icon">Http<wbr/>Req</a></li><li class="tsd-kind-type-alias"><a href="modules.html#HttpRes" class="tsd-kind-icon">Http<wbr/>Res</a></li><li class="tsd-kind-type-alias"><a href="modules.html#ReqHandler" class="tsd-kind-icon">Req<wbr/>Handler</a></li><li class="tsd-kind-type-alias"><a href="modules.html#EntryPoint" class="tsd-kind-icon">Entry<wbr/>Point</a></li><li class="tsd-kind-function"><a href="modules.html#useRequest" class="tsd-kind-icon">use<wbr/>Request</a></li><li class="tsd-kind-function tsd-has-type-parameter"><a href="modules.html#useURL" class="tsd-kind-icon">useURL</a></li><li class="tsd-kind-function tsd-has-type-parameter"><a href="modules.html#createFlare" class="tsd-kind-icon">create<wbr/>Flare</a></li><li class="tsd-kind-function"><a href="modules.html#shimHTTP" class="tsd-kind-icon">shimHTTP</a></li><li class="tsd-kind-interface tsd-has-type-parameter"><a href="interfaces/ConditionInit.html" class="tsd-kind-icon">Condition<wbr/>Init</a></li><li class="tsd-kind-interface tsd-has-type-parameter"><a href="interfaces/Condition.html" class="tsd-kind-icon">Condition</a></li><li class="tsd-kind-function tsd-has-type-parameter"><a href="modules.html#condition" class="tsd-kind-icon">condition</a></li><li class="tsd-kind-type-alias tsd-has-type-parameter"><a href="modules.html#RouteHandler" class="tsd-kind-icon">Route<wbr/>Handler</a></li><li class="tsd-kind-type-alias tsd-has-type-parameter"><a href="modules.html#Route" class="tsd-kind-icon">Route</a></li><li class="tsd-kind-type-alias tsd-has-type-parameter"><a href="modules.html#RouteHandlerX" class="tsd-kind-icon">Route<wbr/>HandlerX</a></li><li class="tsd-kind-type-alias tsd-has-type-parameter"><a href="modules.html#RouteX" class="tsd-kind-icon">RouteX</a></li><li class="tsd-kind-function tsd-has-type-parameter"><a href="modules.html#createRoute" class="tsd-kind-icon">create<wbr/>Route</a></li><li class="tsd-kind-function tsd-has-type-parameter"><a href="modules.html#createRouteX" class="tsd-kind-icon">create<wbr/>RouteX</a></li><li class="tsd-kind-type-alias"><a href="modules.html#RouteChainInit" class="tsd-kind-icon">Route<wbr/>Chain<wbr/>Init</a></li><li class="tsd-kind-type-alias tsd-has-type-parameter"><a href="modules.html#RouteChainAdder" class="tsd-kind-icon">Route<wbr/>Chain<wbr/>Adder</a></li><li class="tsd-kind-type-alias tsd-has-type-parameter"><a href="modules.html#RouteChainFallback" class="tsd-kind-icon">Route<wbr/>Chain<wbr/>Fallback</a></li><li class="tsd-kind-type-alias tsd-has-type-parameter"><a href="modules.html#RouteChain" class="tsd-kind-icon">Route<wbr/>Chain</a></li><li class="tsd-kind-type-alias"><a href="modules.html#RouteChainInitX" class="tsd-kind-icon">Route<wbr/>Chain<wbr/>InitX</a></li><li class="tsd-kind-type-alias tsd-has-type-parameter"><a href="modules.html#RouteChainAdderX" class="tsd-kind-icon">Route<wbr/>Chain<wbr/>AdderX</a></li><li class="tsd-kind-type-alias tsd-has-type-parameter"><a href="modules.html#RouteChainFallbackX" class="tsd-kind-icon">Route<wbr/>Chain<wbr/>FallbackX</a></li><li class="tsd-kind-type-alias tsd-has-type-parameter"><a href="modules.html#RouteChainX" class="tsd-kind-icon">Route<wbr/>ChainX</a></li><li class="tsd-kind-function"><a href="modules.html#createSwRt" class="tsd-kind-icon">create<wbr/>Sw<wbr/>Rt</a></li><li class="tsd-kind-function"><a href="modules.html#createSwRtX" class="tsd-kind-icon">create<wbr/>Sw<wbr/>RtX</a></li><li class="tsd-kind-function tsd-has-type-parameter"><a href="modules.html#createSwitcher" class="tsd-kind-icon">create<wbr/>Switcher</a></li><li class="tsd-kind-function tsd-has-type-parameter"><a href="modules.html#createSwitcherX" class="tsd-kind-icon">create<wbr/>SwitcherX</a></li><li class="tsd-kind-function tsd-has-type-parameter"><a href="modules.html#allowMethods" class="tsd-kind-icon">allow<wbr/>Methods</a></li><li class="tsd-kind-function tsd-has-type-parameter"><a href="modules.html#All" class="tsd-kind-icon">All</a></li><li class="tsd-kind-function tsd-has-type-parameter"><a href="modules.html#Get" class="tsd-kind-icon">Get</a></li><li class="tsd-kind-function tsd-has-type-parameter"><a href="modules.html#Head" class="tsd-kind-icon">Head</a></li><li class="tsd-kind-function tsd-has-type-parameter"><a href="modules.html#Post" class="tsd-kind-icon">Post</a></li><li class="tsd-kind-function tsd-has-type-parameter"><a href="modules.html#Put" class="tsd-kind-icon">Put</a></li><li class="tsd-kind-function tsd-has-type-parameter"><a href="modules.html#Delete" class="tsd-kind-icon">Delete</a></li><li class="tsd-kind-function tsd-has-type-parameter"><a href="modules.html#Connect" class="tsd-kind-icon">Connect</a></li><li class="tsd-kind-function tsd-has-type-parameter"><a href="modules.html#Options" class="tsd-kind-icon">Options</a></li><li class="tsd-kind-function tsd-has-type-parameter"><a href="modules.html#Trace" class="tsd-kind-icon">Trace</a></li><li class="tsd-kind-function tsd-has-type-parameter"><a href="modules.html#Patch" class="tsd-kind-icon">Patch</a></li><li class="tsd-kind-function tsd-has-type-parameter"><a href="modules.html#allowMethodsX" class="tsd-kind-icon">allow<wbr/>MethodsX</a></li><li class="tsd-kind-function tsd-has-type-parameter"><a href="modules.html#AllX" class="tsd-kind-icon">AllX</a></li><li class="tsd-kind-function tsd-has-type-parameter"><a href="modules.html#GetX" class="tsd-kind-icon">GetX</a></li><li class="tsd-kind-function tsd-has-type-parameter"><a href="modules.html#HeadX" class="tsd-kind-icon">HeadX</a></li><li class="tsd-kind-function tsd-has-type-parameter"><a href="modules.html#PostX" class="tsd-kind-icon">PostX</a></li><li class="tsd-kind-function tsd-has-type-parameter"><a href="modules.html#PutX" class="tsd-kind-icon">PutX</a></li><li class="tsd-kind-function tsd-has-type-parameter"><a href="modules.html#DeleteX" class="tsd-kind-icon">DeleteX</a></li><li class="tsd-kind-function tsd-has-type-parameter"><a href="modules.html#ConnectX" class="tsd-kind-icon">ConnectX</a></li><li class="tsd-kind-function tsd-has-type-parameter"><a href="modules.html#OptionsX" class="tsd-kind-icon">OptionsX</a></li><li class="tsd-kind-function tsd-has-type-parameter"><a href="modules.html#TraceX" class="tsd-kind-icon">TraceX</a></li><li class="tsd-kind-function tsd-has-type-parameter"><a href="modules.html#PatchX" class="tsd-kind-icon">PatchX</a></li><li class="tsd-kind-type-alias"><a href="modules.html#Empty" class="tsd-kind-icon">Empty</a></li><li class="tsd-kind-type-alias tsd-has-type-parameter"><a href="modules.html#ParamFlag" class="tsd-kind-icon">Param<wbr/>Flag</a></li><li class="tsd-kind-type-alias tsd-has-type-parameter"><a href="modules.html#RoutePattern" class="tsd-kind-icon">Route<wbr/>Pattern</a></li><li class="tsd-kind-type-alias tsd-has-type-parameter"><a href="modules.html#RouteParam" class="tsd-kind-icon">Route<wbr/>Param</a></li><li class="tsd-kind-type-alias tsd-has-type-parameter"><a href="modules.html#MaybePromise" class="tsd-kind-icon">Maybe<wbr/>Promise</a></li><li class="tsd-kind-type-alias"><a href="modules.html#EncodingType" class="tsd-kind-icon">Encoding<wbr/>Type</a></li><li class="tsd-kind-function"><a href="modules.html#contentType" class="tsd-kind-icon">content<wbr/>Type</a></li><li class="tsd-kind-function"><a href="modules.html#contentLength" class="tsd-kind-icon">content<wbr/>Length</a></li><li class="tsd-kind-function"><a href="modules.html#contentDisposition" class="tsd-kind-icon">content<wbr/>Disposition</a></li><li class="tsd-kind-function"><a href="modules.html#contentEncoding" class="tsd-kind-icon">content<wbr/>Encoding</a></li><li class="tsd-kind-function tsd-has-type-parameter"><a href="modules.html#contentLanguage" class="tsd-kind-icon">content<wbr/>Language</a></li><li class="tsd-kind-function"><a href="modules.html#serverHeader" class="tsd-kind-icon">server<wbr/>Header</a></li><li class="tsd-kind-function"><a href="modules.html#location" class="tsd-kind-icon">location</a></li><li class="tsd-kind-function"><a href="modules.html#acceptRanges" class="tsd-kind-icon">accept<wbr/>Ranges</a></li><li class="tsd-kind-interface tsd-has-type-parameter"><a href="interfaces/Composer.html" class="tsd-kind-icon">Composer</a></li><li class="tsd-kind-function tsd-has-type-parameter"><a href="modules.html#baseCompose" class="tsd-kind-icon">base<wbr/>Compose</a></li><li class="tsd-kind-function tsd-has-type-parameter"><a href="modules.html#composeFn" class="tsd-kind-icon">compose<wbr/>Fn</a></li><li class="tsd-kind-interface tsd-has-type-parameter"><a href="interfaces/Computation.html" class="tsd-kind-icon">Computation</a></li><li class="tsd-kind-function tsd-has-type-parameter"><a href="modules.html#compute" class="tsd-kind-icon">compute</a></li><li class="tsd-kind-interface tsd-has-type-parameter"><a href="interfaces/Lazy.html" class="tsd-kind-icon">Lazy</a></li><li class="tsd-kind-function tsd-has-type-parameter"><a href="modules.html#lazy" class="tsd-kind-icon">lazy</a></li><li class="tsd-kind-function tsd-has-type-parameter"><a href="modules.html#computeLazy" class="tsd-kind-icon">compute<wbr/>Lazy</a></li><li class="tsd-kind-function tsd-has-type-parameter"><a href="modules.html#createEffect" class="tsd-kind-icon">create<wbr/>Effect</a></li><li class="tsd-kind-function"><a href="modules.html#createEffect4Any" class="tsd-kind-icon">create<wbr/>Effect4<wbr/>Any</a></li><li class="tsd-kind-function tsd-has-type-parameter"><a href="modules.html#addEffect" class="tsd-kind-icon">add<wbr/>Effect</a></li><li class="tsd-kind-type-alias"><a href="modules.html#Fn" class="tsd-kind-icon">Fn</a></li><li class="tsd-kind-type-alias"><a href="modules.html#AsyncFn" class="tsd-kind-icon">Async<wbr/>Fn</a></li><li class="tsd-kind-type-alias tsd-has-type-parameter"><a href="modules.html#BeforeHookArray" class="tsd-kind-icon">Before<wbr/>Hook<wbr/>Array</a></li><li class="tsd-kind-function tsd-has-type-parameter"><a href="modules.html#echo" class="tsd-kind-icon">echo</a></li><li class="tsd-kind-function tsd-has-type-parameter"><a href="modules.html#createWrapper" class="tsd-kind-icon">create<wbr/>Wrapper</a></li><li class="tsd-kind-function tsd-has-type-parameter"><a href="modules.html#addWrapper" class="tsd-kind-icon">add<wbr/>Wrapper</a></li><li class="tsd-kind-function tsd-has-type-parameter"><a href="modules.html#isVoid" class="tsd-kind-icon">is<wbr/>Void</a></li><li class="tsd-kind-interface"><a href="interfaces/HasToJSON.html" class="tsd-kind-icon">Has<wbr/>ToJSON</a></li><li class="tsd-kind-type-alias"><a href="modules.html#BasicJSONTypes" class="tsd-kind-icon">BasicJSONTypes</a></li><li class="tsd-kind-type-alias"><a href="modules.html#JsonObject" class="tsd-kind-icon">Json<wbr/>Object</a></li><li class="tsd-kind-type-alias"><a href="modules.html#JsonArray" class="tsd-kind-icon">Json<wbr/>Array</a></li><li class="tsd-kind-type-alias"><a href="modules.html#JsonType" class="tsd-kind-icon">Json<wbr/>Type</a></li><li class="tsd-kind-function"><a href="modules.html#resJson" class="tsd-kind-icon">res<wbr/>Json</a></li></ul></nav></div></div></div><footer class="with-border-bottom"><div class="container"><h2>Legend</h2><div class="tsd-legend-group"><ul class="tsd-legend"><li class="tsd-kind-property tsd-parent-kind-interface"><span class="tsd-kind-icon">Property</span></li><li class="tsd-kind-method tsd-parent-kind-interface"><span class="tsd-kind-icon">Method</span></li></ul><ul class="tsd-legend"><li class="tsd-kind-constructor tsd-parent-kind-class"><span class="tsd-kind-icon">Constructor</span></li><li class="tsd-kind-method tsd-parent-kind-class"><span class="tsd-kind-icon">Method</span></li></ul><ul class="tsd-legend"><li class="tsd-kind-property tsd-parent-kind-class tsd-is-private"><span class="tsd-kind-icon">Private property</span></li></ul><ul class="tsd-legend"><li class="tsd-kind-method tsd-parent-kind-class tsd-is-static"><span class="tsd-kind-icon">Static method</span></li></ul></div><h2>Settings</h2><p>Theme <select id="theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></p></div></footer><div class="container tsd-generator"><p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></div><div class="overlay"></div><script src="assets/main.js"></script></body></html>